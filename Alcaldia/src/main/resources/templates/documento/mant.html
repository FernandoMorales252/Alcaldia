<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/_MainLayout}">
<head>
    <title layout:fragment="title" th:text="'Documento - ' + ${action}">Documento</title>
</head>
<body>
<section layout:fragment="content">
    <style>
    /* ===== Paleta base ===== */
    :root {
      --main-dark: #2C3E50 !important;        /* Azul noche */
      --primary-accent: #2E86C1 !important;   /* Azul serio */
      --secondary-accent: #E67E22 !important; /* Naranja calabaza */
      --success: #27AE60 !important;          /* Verde institucional */
      --danger: #C0392B !important;           /* Rojo formal */
      --text-light: #ECF0F1 !important;       /* Gris nube */
      --text-soft: #BDC3C7 !important;        /* Gris plata */
      --background: #F4F6F9 !important;       /* Fondo gris muy claro */
      --white: #ffffff !important;
      --shadow: rgba(0,0,0,0.08) !important;
    }

    /* ===== General ===== */
    body {
      background-color: var(--background) !important;
      font-family: "Segoe UI", "Roboto", sans-serif !important;
      color: var(--main-dark) !important;
      font-size: 15px !important;
      line-height: 1.5 !important;
    }

    h2 {
      font-size: 2rem !important;
      color: var(--main-dark) !important;
      font-weight: 600 !important;
      padding-bottom: 10px !important;
      margin-bottom: 20px !important;
      border-bottom: 3px solid var(--primary-accent) !important;
    }

    /* ===== Formulario ===== */
    form {
      background-color: var(--white) !important;
      padding: 25px !important;
      border-radius: 10px !important;
      box-shadow: 0 6px 14px var(--shadow) !important;
      max-width: 700px !important;
      margin: 0 auto 30px auto !important;
    }

    label {
      font-weight: 600 !important;
      color: var(--main-dark) !important;
      margin-bottom: 5px !important;
      display: block !important;
    }

    input.form-control, textarea.form-control, select.form-select {
      border: 1px solid var(--text-soft) !important;
      border-radius: 6px !important;
      padding: 8px 12px !important;
      width: 100% !important;
      background-color: var(--white) !important;
      color: var(--main-dark) !important;
      font-size: 0.95rem !important;
      transition: all 0.2s ease !important;
    }

    input.form-control:focus, textarea.form-control:focus, select.form-select:focus {
      border-color: var(--primary-accent) !important;
      box-shadow: 0 0 5px rgba(46, 134, 193, 0.3) !important;
      outline: none !important;
    }

    .text-danger {
      font-size: 0.85rem !important;
      margin-top: 3px !important;
      color: var(--danger) !important;
    }

    /* ===== Botones ===== */
    .btn {
      font-weight: 500 !important;
      border-radius: 6px !important;
      border: none !important;
      padding: 8px 16px !important;
      font-size: 0.95rem !important;
      transition: all 0.2s ease !important;
      box-shadow: 0 2px 6px var(--shadow) !important;
      margin-right: 5px !important;
    }

    .btn:hover {
      transform: translateY(-2px) !important;
    }

    .btn-primary {
      background-color: var(--primary-accent) !important;
      color: var(--white) !important;
    }

    .btn-success {
      background-color: var(--success) !important;
      color: var(--white) !important;
    }

    .btn-danger {
      background-color: var(--danger) !important;
      color: var(--white) !important;
    }

    .btn-secondary {
      background-color: var(--text-soft) !important;
      color: var(--main-dark) !important;
    }

    .btn-secondary:hover {
      background-color: var(--primary-accent) !important;
      color: var(--white) !important;
    }

    /* ===== Mensajes ===== */
    .alert {
      border-radius: 6px !important;
      padding: 12px 20px !important;
      font-size: 0.95rem !important;
      max-width: 700px !important;
      margin: 15px auto !important;
      box-shadow: 0 4px 10px var(--shadow) !important;
    }
  </style>
    <h2 th:text="${action == 'create' ? 'Crear Documento' : 
                     action == 'edit' ? 'Editar Documento' : 
                     action == 'view' ? 'Ver Documento' : 
                     action == 'delete' ? 'Eliminar Documento' : 'Documento'}"></h2>
    
    <!-- Mensaje de error para unicidad -->
    <div th:if="${error}" class="alert alert-danger" role="alert">
        <span th:text="${error}"></span>
    </div>

    <form th:action="@{${action == 'create' ? '/documentos/create' : 
                           action == 'edit' ? '/documentos/edit' : 
                           action == 'delete' ? '/documentos/delete' : '#'}}" 
          th:object="${documentoArchivo}" method="post" id="proyectoForm">

        <input type="hidden" th:if="${documentoArchivo.idDocumento != null}" th:field="*{idDocumento}" />

        <!-- Número de Documento -->
        <div class="mb-3">
            <label for="numeroDocumento" class="form-label">Número de documento</label>
            <input type="text" th:field="*{numeroDocumento}" id="numeroDocumento" class="form-control"
                   th:attr="readonly=${action=='view' or action=='delete'}" required/>
            <div class="text-danger" th:if="${#fields.hasErrors('numeroDocumento')}" th:errors="*{numeroDocumento}"></div>
        </div>

        <!-- Nombre Persona -->
        <div class="mb-3">
            <label for="nombrePersona" class="form-label">Propietario</label>
            <input type="text" th:field="*{nombrePersona}" id="nombrePersona" class="form-control"
                   th:attr="readonly=${action=='view' or action=='delete'}" required/>
            <div class="text-danger" th:if="${#fields.hasErrors('nombrePersona')}" th:errors="*{nombrePersona}"></div>
        </div>

        <!-- Detalles -->
        <div class="mb-3">
            <label for="detalles" class="form-label">Detalles</label>
            <textarea th:field="*{detalles}" id="detalles" class="form-control"
                      th:attr="readonly=${action=='view' or action=='delete'}"></textarea>
            <div class="text-danger" th:if="${#fields.hasErrors('detalles')}" th:errors="*{detalles}"></div>
        </div>

        <!-- Estado -->
        <div class="mb-3">
            <label for="estado" class="form-label">Estado</label>
            <select th:field="*{estado}" id="estado" class="form-select"
                    th:disabled="${action=='view' or action=='delete'}" required>
                <option value="1">Activo</option>
                <option value="0">Inactivo</option>
            </select>
            <div class="text-danger" th:if="${#fields.hasErrors('estado')}" th:errors="*{estado}"></div>
        </div>

        <!-- Fecha de Emisión -->
        <div class="mb-3">
            <label for="fechaEmision" class="form-label">Fecha de emisión</label>
            <input type="date" th:field="*{fechaEmision}" id="fechaEmision" class="form-control"
                   th:attr="readonly=${action=='view' or action=='delete'}" required/>
            <div class="text-danger" th:if="${#fields.hasErrors('fechaEmision')}" th:errors="*{fechaEmision}"></div>
        </div>

        <!-- Municipio - CORREGIDO -->
        <div class="mb-3">
            <label for="municipioId" class="form-label">Municipio</label>
            <select name="municipioId" id="municipioId" class="form-select"
                    th:disabled="${action=='view' or action=='delete'}" required>
                <option value="">Seleccione municipio</option>
                <option th:each="mun : ${municipios}" 
                        th:value="${mun.id_municipio}" 
                        th:text="${mun.nombre_municipio}"
                        th:selected="${documentoArchivo.municipio != null and documentoArchivo.municipio.id_municipio == mun.id_municipio}"></option>
            </select>
        </div>

        <!-- Tipo de Documento - CORREGIDO -->
        <div class="mb-3">
            <label for="tipoDocumentoId" class="form-label">Tipo de documento</label>
            <select name="tipoDocumentoId" id="tipoDocumentoId" class="form-select"
                    th:disabled="${action=='view' or action=='delete'}" required>
                <option value="">Seleccione tipo de documento</option>
                <option th:each="tipo : ${tipos_documentos}" 
                        th:value="${tipo.id_tipo_documento}" 
                        th:text="${tipo.nombre_tipo}"
                        th:selected="${documentoArchivo.tipoDocumento != null and documentoArchivo.tipoDocumento.id_tipo_documento == tipo.id_tipo_documento}"></option>
            </select>
        </div>

        <!-- Botones -->
        <div th:if="${action != 'view'}" class="mb-3">
            <button type="submit" 
                    th:text="${action == 'delete' ? 'Confirmar Eliminación' : 'Guardar'}" 
                    class="btn" 
                    th:classappend="${action == 'delete' ? 'btn-danger' : 'btn-primary'}"></button>
            <a th:href="@{/documentos}" class="btn btn-secondary">Cancelar</a>
        </div>

        <div th:if="${action == 'view'}" class="mb-3">
            <a th:href="@{/documentos}" class="btn btn-secondary">Regresar</a>
        </div>
    </form>
</section>
</body>
</html>

